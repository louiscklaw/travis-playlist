(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"/na4":function(e,t,n){"use strict";n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return u})),n.d(t,"f",(function(){return h})),n.d(t,"e",(function(){return v})),n.d(t,"b",(function(){return y})),n.d(t,"d",(function(){return p}));n("pJf4"),n("q8oJ"),n("YbXK"),n("cFtU"),n("rzGZ"),n("m210"),n("4DPX");var r=n("o0o1"),a=n.n(r);n("ls82"),n("6kNP"),n("8npG"),n("sC2a"),n("HQhv");function o(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,a,o,c){try{var i=e[o](c),s=i.value}catch(l){return void n(l)}i.done?t(s):Promise.resolve(s).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){i(o,r,a,c,s,"next",e)}function s(e){i(o,r,a,c,s,"throw",e)}c(void 0)}))}}var l="https://api.travis-ci.com/owner/louiscklaw/repos";function u(){return fetch("https://raw.githubusercontent.com/louiscklaw/travis-playlist/db/branch_fail_statistics.json")}function f(){return fetch("https://raw.githubusercontent.com/louiscklaw/travis-playlist/db/build_failed_list.json")}function m(e,t){return fetch(e,{headers:{"Travis-API-Version":3,Authorization:t,"Content-Type":"application/xml"}})}function p(e){try{var t=e.split("/")}catch(n){throw console.error("findme",e),n}return t[4]+"/"+t[5]}function h(e){return m(l,e)}function d(e,t){return m(e,t).then((function(e){return e.json()}))}function v(e,t){return b.apply(this,arguments)}function b(){return(b=s(a.a.mark((function e(t,n){var r,c,i,s,u,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],c=!0,100,i=l;case 4:if(!c){e.next=16;break}return e.next=7,d(i,t);case 7:if(s=e.sent,u=s["@pagination"],void 0!==s["@type"]&&"error"==s["@type"]&&(alert("error found on fetching result"),alert(t),c=!1),void 0===u?c=!1:(c=u.next,f=u.next?u.next["@href"]:null,i="https://api.travis-ci.com"+f,r=[].concat(o(r),o(s.repositories))),1!=n){e.next=14;break}return console.log("fetch_one_page_only is on"),e.abrupt("break",16);case 14:e.next=4;break;case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return"https://api.travis-ci.com/repo/github/"+function(e){try{return e.replace("/","%2F")}catch(t){throw console.log(e),t}}(e)+"/branches"}function y(e,t){return d(g(e),t).then((function(e){return t=e.branches.map((function(e){return e.last_build})),n=t.filter((function(e){return"failed"==e.state})),t.filter((function(e){return"passed"!=e.state})),console.log("findme last_build",t),n;var t,n})).then((function(t){return t.map((function(t){return n=e,r=t["@href"],"https://travis-ci.com/github/"+n+r.replace("build","builds");var n,r}))}))}},"7tjn":function(e,t,n){"use strict";n("HQhv");var r=n("q1tI"),a=n.n(r);n("Wbzz");t.a=function(e){var t=e.repo_name,n=e.content;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"card"},a.a.createElement("header",{className:"card-header"},a.a.createElement("p",{className:"card-header-title"},a.a.createElement("a",{href:"http://www.github.com/"+t,className:"button is-white is-small",target:"_blank"},a.a.createElement("i",{class:"fab fa-github-square fa-2x"}),t.split("/")[1]))),a.a.createElement("div",{className:"card-content"},a.a.createElement("div",{className:"content"},a.a.createElement("div",{className:"tags"},n.map((function(e){return a.a.createElement("span",{class:"tag is-danger"},a.a.createElement("a",{href:e,style:{color:"white",padding:"3px;"},target:"_blank"},a.a.createElement("i",{class:"fas fa-times"}),function(e){try{return e.split("/")[7]}catch(t){throw console.log("at build_failed_card.js",e),t}}(e)))}))))),a.a.createElement("footer",{className:"card-footer"})))}},"XNc+":function(e,t,n){"use strict";n.r(t);n("sPse"),n("Ggvi"),n("6kNP"),n("rzGZ"),n("Dq+y"),n("8npG"),n("YbXK");var r=n("q1tI"),a=n.n(r),o=n("Bl7J"),c=n("vrFN"),i=n("RMg3"),s=n("+NQN"),l=n("/na4"),u=n("7tjn");var f=function(e){var t=e.num_fails,n=e.num_repos;return a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",{className:"title is-3"},"list of failed branches(live)"),a.a.createElement("h2",{className:"subtitle is-6"},"(number of repos: ",n,", number of fails ",t,")"))};function m(e,t){var n=0,r=e.length,a=[];for(n=0;n<r;n+=t){var o=e.slice(n,n+t);a.push(o)}return a}function p(e){var t=e.show_repo_name,n=e.last_builds_failed;return a.a.createElement(a.a.Fragment,null,t.map((function(e){return a.a.createElement("div",{className:"columns is-desktop"},e.map((function(e){return a.a.createElement("div",{className:"column"},a.a.createElement(u.a,{repo_name:e,content:n[e]}))})))})))}t.default=function(e){var t=a.a.useContext(s.b).travis_token,n=a.a.useState(),r=(n[0],n[1]),u=a.a.useState([]),h=(u[0],u[1],a.a.useState([])),d=h[0],v=h[1],b=a.a.useState({}),g=b[0],y=b[1],E=a.a.useState(""),_=E[0],w=E[1],N=a.a.useState(),k=N[0],j=(N[1],a.a.useState(18e4)),S=j[0],x=(j[1],a.a.useState({})),A=x[0],O=x[1];function P(){console.log("load repo from travis"),Promise.all([Object(l.e)(t)]).then((function(e){O(e[0]),console.log("raw repo list updated")}))}return a.a.useEffect((function(){if(void 0!==t&&(r("loading"),A.length>0)){console.log("into raw_repo_list"),console.log("raw_repo_list",A);var e=A.map((function(e){return e.slug}));console.log("repo_list",e),function(e,t){return console.log("into fetchRepoLastBuildStatus"),Promise.all(e.map((function(e){return Object(l.b)(e,t)})))}(e,t).then((function(e){return console.log("repos_results",e),e.filter((function(e){return e.length>0}))})).then((function(e){console.log("failed_list",e);var t=function(e){var t={};try{e.forEach((function(e){var n=Object(l.d)(e[0]),r=e;t[n]=r}))}catch(n){console.log("failed_list",e)}return t}(e);y(t),v(m(Object.keys(t),6))}))}}),[t,A]),a.a.useEffect((function(){var e=Object.keys(g).filter((function(e){return e.search(_)>-1}));v(m(e,6))}),[_,g]),a.a.useEffect((function(){P(),setInterval((function(){console.log("refresh happening"),P()}),S)}),[]),a.a.createElement(a.a.Fragment,null,a.a.createElement(o.a,null,a.a.createElement(c.a,{title:"travis dashboard"}),a.a.createElement(i.a,null),a.a.createElement("section",{className:"section"},a.a.createElement("div",{className:"container"},a.a.createElement(f,null),a.a.createElement("input",{type:"text",placeholder:"repo filter",onChange:function(e){return function(e){var t=e.target.value.trim();w(t)}(e)},value:_}))),JSON.stringify(k),a.a.createElement(p,{show_repo_name:d,last_builds_failed:g})))}}}]);
//# sourceMappingURL=component---src-pages-list-failed-branch-live-js-9cbc1c5fd14dcaada501.js.map